#!/usr/bin/env python3
"""
æµ‹è¯•å›¾ç‰‡ç²˜è´´åŠŸèƒ½å’Œä¸´æ—¶æ–‡ä»¶å¤„ç†
"""

import sys
import os
import json

# æ·»åŠ å½“å‰ç›®å½•åˆ° Python è·¯å¾„
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))

from feedback_ui import feedback_ui

def test_image_paste():
    """æµ‹è¯•å›¾ç‰‡ç²˜è´´åŠŸèƒ½"""
    
    prompt = """ğŸ–¼ï¸ æµ‹è¯•å›¾ç‰‡ç²˜è´´åŠŸèƒ½

## æµ‹è¯•æ­¥éª¤ï¼š

1. **å¤åˆ¶å›¾ç‰‡åˆ°å‰ªè´´æ¿**ï¼š
   - ä»ä»»ä½•åº”ç”¨ç¨‹åºå¤åˆ¶ä¸€å¼ å›¾ç‰‡ï¼ˆå¦‚æˆªå›¾ã€æµè§ˆå™¨ä¸­çš„å›¾ç‰‡ç­‰ï¼‰
   - æˆ–è€…ä½¿ç”¨ç³»ç»Ÿæˆªå›¾å·¥å…·ï¼ˆå¦‚ macOS çš„ Cmd+Shift+4ï¼‰

2. **ç²˜è´´å›¾ç‰‡**ï¼š
   - ç‚¹å‡»"ğŸ“‹ ç²˜è´´å›¾ç‰‡"æŒ‰é’®
   - å›¾ç‰‡åº”è¯¥æ˜¾ç¤ºåœ¨å›¾ç‰‡åŒºåŸŸä¸­
   - æ§åˆ¶å°åº”è¯¥æ˜¾ç¤ºä¸´æ—¶æ–‡ä»¶è·¯å¾„

3. **æäº¤åé¦ˆ**ï¼š
   - è¾“å…¥ä¸€äº›æ–‡å­—åé¦ˆ
   - ç‚¹å‡»"âœ… æäº¤åé¦ˆ"
   - æ£€æŸ¥è¿”å›çš„ JSON ä¸­æ˜¯å¦åŒ…å«æ­£ç¡®çš„å›¾ç‰‡è·¯å¾„

## é¢„æœŸæ•ˆæœï¼š

- ç²˜è´´çš„å›¾ç‰‡åº”è¯¥æ­£ç¡®æ˜¾ç¤º
- ä¸´æ—¶æ–‡ä»¶è·¯å¾„åº”è¯¥æœ‰æ•ˆ
- æäº¤åé¦ˆåï¼ŒMCP è°ƒç”¨è€…åº”è¯¥èƒ½å¤Ÿè®¿é—®å›¾ç‰‡æ–‡ä»¶
- ä¸åº”è¯¥å‡ºç°"æ–‡ä»¶ä¸å­˜åœ¨"é”™è¯¯

è¯·æŒ‰ç…§ä»¥ä¸Šæ­¥éª¤æµ‹è¯•å›¾ç‰‡ç²˜è´´åŠŸèƒ½ï¼"""
    
    print("ğŸ§ª å¯åŠ¨å›¾ç‰‡ç²˜è´´åŠŸèƒ½æµ‹è¯•...")
    print("ğŸ“‹ è¯·å…ˆå¤åˆ¶ä¸€å¼ å›¾ç‰‡åˆ°å‰ªè´´æ¿ï¼Œç„¶åç‚¹å‡»'ç²˜è´´å›¾ç‰‡'æŒ‰é’®")
    print("ğŸ–¼ï¸  æµ‹è¯•å›¾ç‰‡æ˜¯å¦èƒ½æ­£ç¡®æ˜¾ç¤ºå’Œä¿å­˜")
    print()
    
    # å¯åŠ¨åé¦ˆç•Œé¢è¿›è¡Œæµ‹è¯•
    result = feedback_ui(
        project_directory=os.getcwd(),
        prompt=prompt,
        dark_theme=True
    )
    
    if result:
        print("âœ… å›¾ç‰‡ç²˜è´´æµ‹è¯•å®Œæˆ")
        feedback_data = json.loads(result['interactive_feedback'])
        print(f"ğŸ“„ æ–‡å­—åé¦ˆ: {feedback_data.get('text_feedback', '')}")
        
        images = feedback_data.get('images', [])
        if images:
            print(f"ğŸ–¼ï¸  å›¾ç‰‡æ•°é‡: {len(images)}")
            for i, image_path in enumerate(images):
                print(f"   å›¾ç‰‡ {i+1}: {image_path}")
                # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
                if os.path.exists(image_path):
                    print(f"   âœ… æ–‡ä»¶å­˜åœ¨")
                    # è·å–æ–‡ä»¶å¤§å°
                    size = os.path.getsize(image_path)
                    print(f"   ğŸ“ æ–‡ä»¶å¤§å°: {size} å­—èŠ‚")
                else:
                    print(f"   âŒ æ–‡ä»¶ä¸å­˜åœ¨ï¼")
        else:
            print("ğŸ“· æ²¡æœ‰é€‰æ‹©å›¾ç‰‡")
    else:
        print("âŒ æµ‹è¯•è¢«å–æ¶ˆ")

if __name__ == "__main__":
    test_image_paste() 